<p>form works!</p>
<h2 mat-dialog-title *ngIf="isUpdateMode">Update {{ model.name }} by {{ model.author.pseudo }} </h2>
<h2 mat-dialog-title *ngIf="!isUpdateMode">Create new recipe</h2>

<mat-dialog-content>
  <form novalidate [formGroup]="productForm">

    <table class="full-width" cellspacing="0">
      <tr>
        <td>
          <mat-form-field class="full-width" [class.mgb15]="productForm.get('name')?.dirty && productForm.get('name')?.invalid" [floatLabel]="'never'">
            <input type="text" matInput formControlName="name" minlength="2" name="name"/>
            <mat-placeholder class="flexible">Recipe name</mat-placeholder>
            <mat-error *ngIf="productForm.get('name')?.dirty && productForm.get('name')?.hasError('required')">
              Recipe name is <strong>required</strong>
            </mat-error>
            <mat-error *ngIf="productForm.get('name')?.dirty && productForm.get('name')?.hasError('minlength')">
              Recipe name is <strong>2 chars min</strong>
            </mat-error>
          </mat-form-field>

          <mat-form-field class="full-width" [class.mgb15]="productForm.get('description')?.dirty && productForm.get('description')?.invalid" [floatLabel]="'never'">
            <input matInput name="description"  formControlName="description" minlength="2" required/>
            <mat-placeholder class="flexible">Description</mat-placeholder>
            <mat-error *ngIf="productForm.get('description')?.dirty && productForm.get('description')?.hasError('required')">
              Description is <strong>required</strong>
            </mat-error>
            <mat-error *ngIf="productForm.get('description')?.dirty && productForm.get('description')?.hasError('minlength')">
              Description is <strong>2 chars min</strong>
            </mat-error>
          </mat-form-field>

          <p formGroupName="author">
            <mat-form-field class="full-width" [class.mgb15]="productForm.get('pseudo')?.dirty && productForm.get('pseudo')?.invalid" [floatLabel]="'never'">
              <input matInput formControlName="pseudo" required name="pseudo"/>
              <mat-placeholder class="flexible">Author</mat-placeholder>
              <mat-error *ngIf="productForm.get('author')?.get('pseudo')?.dirty && productForm.get('author')?.get('pseudo')?.hasError('required')">
                Pseudo is <strong>required</strong>
              </mat-error>
            </mat-form-field>
          </p>

          <table class="full-width" cellspacing="0" formGroupName="author">
            <tr>
              <td>
                <mat-form-field class="full-width" [class.mgb15]="productForm.get('firstname')?.dirty && productForm.get('firstname')?.invalid" [floatLabel]="'never'">
                  <input matInput name="firstname"  formControlName="firstname" minlength="2" required/>
                  <mat-placeholder class="flexible">Firstname</mat-placeholder>
                  <mat-error *ngIf="productForm.get('author')?.get('firstname')?.dirty && productForm.get('author')?.get('firstname')?.hasError('required')">
                    Firstname is <strong>required</strong>
                  </mat-error>
                  <mat-error *ngIf="productForm.get('author')?.get('firstname')?.dirty && productForm.get('author')?.get('firstname')?.hasError('minlength')">
                    Firstname is <strong>2 chars min</strong>
                  </mat-error>
                </mat-form-field>
              </td>
              <td>
                <mat-form-field class="full-width" [class.mgb15]="productForm.get('lastname')?.dirty && productForm.get('lastname')?.invalid" [floatLabel]="'never'">
                  <input matInput name="lastname" formControlName="lastname" minlength="2" required/>
                  <mat-placeholder class="flexible">Lastname</mat-placeholder>
                  <mat-error *ngIf="productForm.get('author')?.get('lastname')?.dirty && productForm.get('author')?.get('lastname')?.hasError('required')">
                    Lastname is <strong>required</strong>
                  </mat-error>
                  <mat-error *ngIf="productForm.get('author')?.get('lastname')?.dirty && productForm.get('author')?.get('lastname')?.hasError('minlength')">
                    Lastname is <strong>2 chars min</strong>
                  </mat-error>
                </mat-form-field>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>

    <table class="table table-bordered" formArrayName="ingredients">
      <tr>
        <th colspan="2">Liste des ingrédients:</th>
        <th width="150px"><button type="button" (click)="addIngredient()" class="btn btn-primary">Ajouter ingédient</button></th>
      </tr>
      <tr *ngFor="let quantity of ingredients.controls; let i=index" [formGroupName]="i">
        <td>
          <mat-form-field class="full-width" [class.mgb15]="productForm.get('ingredients')?.dirty && productForm.get('ingredients')?.invalid" [floatLabel]="'never'">
            Ingrédient :
            <div class="row" *ngIf="isAddedIngr">
              <div class="col s12">
                <mat-form-field class="full-width" [class.mgb15]="productForm.get('ingredients')?.dirty && productForm.get('ingredients')?.invalid" [floatLabel]="'never'">
                  <input matInput type="text" name="ingredients" formControlName="ingredients" minlength="2" required>
                  <mat-placeholder class="flexible">Ingredients</mat-placeholder>
                  <mat-error *ngIf="productForm.get('ingredients')?.dirty && productForm.get('ingredients')?.hasError('required')">
                    Ingredient is <strong>required</strong>
                  </mat-error>
                  <mat-error *ngIf="productForm.get('ingredients')?.dirty && productForm.get('ingredients')?.hasError('minlength')">
                    Ingredient is <strong>2 chars min</strong>
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

          </mat-form-field>
        </td>
        <td>
          <button (click)="removeIngredient(i)" class="btn btn-danger">Supprimer</button>
        </td>
      </tr>
    </table>

    <table class="table table-bordered" formArrayName="steps">
      <tr>
        <th colspan="2">Liste des étapes:</th>
        <th width="150px"><button type="button" (click)="addStep()" class="btn btn-primary">Ajouter une étape</button></th>
      </tr>
      <tr *ngFor="let quantity of steps.controls; let i=index" [formGroupName]="i">
        <mat-form-field class="full-width" [class.mgb15]="productForm.get('step')?.dirty && productForm.get('step')?.invalid" [floatLabel]="'never'">
        <td>
          Step :
          <div class="row" *ngIf="isAddedStep">
            <div class="col s12">
              <mat-form-field class="full-width" [class.mgb15]="productForm.get('step')?.dirty && productForm.get('step')?.invalid" [floatLabel]="'never'">
                <input matInput type="text" name="step" formControlName="step" minlength="2" required>
                <mat-placeholder class="flexible">Step</mat-placeholder>
                <mat-error *ngIf="productForm.get('step')?.dirty && productForm.get('step')?.hasError('required')">
                  Step is <strong>required</strong>
                </mat-error>
                <mat-error *ngIf="productForm.get('step')?.dirty && productForm.get('step')?.hasError('minlength')">
                  Step is <strong>2 chars min</strong>
                </mat-error>
              </mat-form-field>
            </div>
          </div>

        </td>
        <td>
          <button (click)="removeStep(i)" class="btn btn-danger">Supprimer</button>
        </td>
        </mat-form-field>
      </tr>
    </table>

    <table class="full-width" cellspacing="0">
      <tr>
        <td>
          <mat-form-field class="full-width" [class.mgb15]="productForm.get('difficulty')?.dirty && productForm.get('difficulty')?.invalid" [floatLabel]="'never'">
            <input matInput type="number" name="difficulty" formControlName="difficulty" required/>
            <mat-placeholder class="flexible">Difficulty</mat-placeholder>
            <mat-error *ngIf="productForm.get('difficulty')?.dirty && productForm.get('difficulty')?.hasError('required')">
              Difficulty is <strong>required</strong>
            </mat-error>
          </mat-form-field>
          <mat-form-field class="full-width" [class.mgb15]="productForm.get('preparationTime')?.dirty && productForm.get('preparationTime')?.invalid" [floatLabel]="'never'">
            <input matInput type="number" name="preparationTime" formControlName="preparationTime" required/>
            <mat-placeholder class="flexible">Preparation time</mat-placeholder>
            <mat-error *ngIf="productForm.get('preparationTime')?.dirty && productForm.get('preparationTime')?.hasError('required')">
              Preparation time is <strong>required</strong>
            </mat-error>
          </mat-form-field>
          <mat-form-field class="full-width" [class.mgb15]="productForm.get('cookingTime')?.dirty && productForm.get('cookingTime')?.invalid" [floatLabel]="'never'">
            <input matInput type="number" name="cookingTime" formControlName="cookingTime" required/>
            <mat-placeholder class="flexible">Cooking time</mat-placeholder>
            <mat-error *ngIf="productForm.get('cookingTime')?.dirty && productForm.get('cookingTime')?.hasError('required')">
              Cooking time is <strong>required</strong>
            </mat-error>
          </mat-form-field>
        </td>
      </tr>
    </table>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button type="button" (click)="cancel()">Cancel</button>
  <button mat-button color="primary" type="submit" (click)="submit(productForm.value)"  [disabled]="productForm.invalid" >Save</button>
</mat-dialog-actions>
